<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Planning - Planner Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="routes-ui.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; align-items: center; gap: 12px;">
                <button class="nav-collapse-btn" id="nav-collapse-btn" title="Toggle Navigation">
                    <span class="collapse-icon">‚óÄ</span>
                </button>
                <h1>Route Planning Dashboard</h1>
            </div>
            <nav class="tabs">
                <button class="tab-btn active" data-tab="orders" data-icon="üì¶" title="Orders"><span>Orders</span></button>
                <button class="tab-btn" data-tab="routes" data-icon="üõ£Ô∏è" title="Routes"><span>Routes</span></button>
                <button class="tab-btn" data-tab="drivers" data-icon="üë•" title="Drivers"><span>Drivers</span></button>
                <button class="tab-btn" data-tab="summary" data-icon="üìä" title="Summary"><span>Summary</span></button>
                <button class="tab-btn" data-tab="archive" data-icon="üìö" title="Archive"><span>Archive</span></button>

                <!-- Route-specific controls (only visible on routes tab) -->
                <div class="route-header-controls" id="route-header-controls" style="display: none;">
                    <button class="btn-icon" id="add-orders-btn" title="Add Orders">+</button>
                    <button class="btn btn-secondary" id="depots-btn" title="View Depots">üè¢ Depots</button>
                    <button class="btn-icon" id="date-prev" title="Previous Day">‚Äπ</button>
                    <div id="date-selector" class="date-selector">
                        <span id="current-date">Sun, Nov 23</span>
                    </div>
                    <button class="btn-icon" id="date-next" title="Next Day">‚Ä∫</button>
                    <button class="btn-icon" id="search-btn" title="Search">üîç</button>
                    <button class="btn-icon" id="undo-btn" title="Undo">‚Ü∂</button>
                    <button class="btn-icon" id="redo-btn" title="Redo">‚Ü∑</button>
                    <button class="btn btn-primary" id="plan-routes-btn">Plan Routes</button>
                </div>

                <button class="btn btn-secondary" onclick="window.open('help.html', '_blank')" style="margin-left: auto;">Help</button>
            </nav>
        </header>

        <!-- Orders Tab -->
        <div id="orders-tab" class="tab-content active">
            <div class="section-header">
                <h2>Order Management</h2>
                <div class="actions">
                    <button class="btn btn-primary" onclick="showAddOrderModal()">+ Add Order</button>
                    <button class="btn btn-secondary" onclick="showUploadModal()">üìÑ Upload Document</button>
                    <button class="btn btn-secondary" onclick="showPhoneCallModal()">üìû Simulate Phone Call</button>
                </div>
            </div>

            <div style="display: flex; gap: 12px; margin-bottom: 20px; align-items: center;">
                <button class="stat-pill active" id="all-orders-pill" onclick="switchOrderView('all')" data-view="all">
                    <span>Orders</span>
                    <span id="all-orders-count">0</span>
                </button>
                <button class="stat-pill" id="unfinished-orders-pill" onclick="switchOrderView('unfinished')" data-view="unfinished">
                    <span>Unfinished Orders</span>
                    <span id="unfinished-orders-count">0</span>
                </button>
            </div>

            <div class="filters">
                <select id="order-status-filter" onchange="loadOrders()">
                    <option value="">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="assigned">Assigned</option>
                    <option value="in_transit">In Transit</option>
                    <option value="completed">Completed</option>
                </select>
                <select id="order-source-filter" onchange="loadOrders()">
                    <option value="">All Sources</option>
                    <option value="email">Email</option>
                    <option value="fax">Fax</option>
                    <option value="mail">Mail</option>
                    <option value="phone">Phone</option>
                </select>
            </div>

            <div id="orders-list" class="orders-grid"></div>
        </div>

        <!-- Drivers Tab -->
        <div id="drivers-tab" class="tab-content">
            <div class="section-header">
                <h2>Driver Management</h2>
                <button class="btn btn-primary" onclick="showAddDriverModal()">+ Add Driver</button>
            </div>
            <div id="drivers-list" class="drivers-grid"></div>
        </div>

        <!-- Routes Tab -->
        <div id="routes-tab" class="tab-content">

            <!-- Statistics Bar -->
            <div class="statistics-bar">
                <div class="stat-item">
                    <span class="stat-icon">üë§</span>
                    <span class="stat-label">Drivers</span>
                    <span class="stat-value" id="stat-drivers">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üì¶</span>
                    <span class="stat-label">Packages</span>
                    <span class="stat-value" id="stat-packages">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üõ£Ô∏è</span>
                    <span class="stat-label">Distance</span>
                    <span class="stat-value" id="stat-distance">0km</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚è±Ô∏è</span>
                    <span class="stat-label">Time</span>
                    <span class="stat-value" id="stat-time">0h 0m</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üè¢</span>
                    <span class="stat-label">Depots</span>
                    <span class="stat-value" id="stat-depots">1</span>
                </div>
                <div class="stat-item" id="stat-stops" style="display: none;">
                    <span class="stat-icon">üìç</span>
                    <span class="stat-label">Stops</span>
                    <span class="stat-value" id="stat-stops-value">0</span>
                </div>
                <div class="stat-item" id="stat-routing" style="display: none;">
                    <span class="stat-label" id="stat-routing-label">üõ£Ô∏è Real roads</span>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="routes-main-content">
                <!-- Left Panel: Routes List -->
                <div class="routes-list-panel" id="routes-list-panel">
                    <div class="routes-panel-header">
                        <div class="routes-panel-title">
                            <button class="collapse-btn" id="routes-panel-toggle" title="Toggle Routes Panel">
                                <span class="collapse-icon">‚óÄ</span>
                            </button>
                            <h3>Routes</h3>
                        </div>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="timeline" title="Timeline View">üìÖ</button>
                        </div>
                    </div>
                    <div id="routes-list-container" class="routes-list-container">
                        <!-- Routes will be populated here -->
                    </div>
                </div>

                <!-- Timeline View (shown when üìÖ button is clicked) -->
                <div class="routes-timeline-view" id="routes-timeline-view" style="display: none;">
                    <div class="timeline-view-header">
                        <h3>Route Timeline</h3>
                        <button class="collapse-btn" id="timeline-collapse-btn" title="Collapse Timeline">
                            <span class="collapse-icon">‚ñ∂</span>
                        </button>
                    </div>
                    <div id="timeline-view-content" class="timeline-view-content">
                        <!-- Timeline stops will be rendered here -->
                    </div>
                </div>

                <!-- Center: Map -->
                <div class="routes-map-panel" id="routes-map-panel">
                    <div id="route-map-container" class="map-container">
                        <div id="route-map"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Locations Tab -->
        <div id="locations-tab" class="tab-content">
            <div class="section-header">
                <h2>Location Management</h2>
                <div class="actions">
                    <button class="btn btn-primary" onclick="showAddDepotModal()">+ Add Depot</button>
                    <button class="btn btn-secondary" onclick="showAddParkingModal()">+ Add Parking</button>
                </div>
            </div>
            <div class="locations-section">
                <div>
                    <h3>Depots</h3>
                    <div id="depots-list"></div>
                </div>
                <div>
                    <h3>Parking Locations</h3>
                    <div id="parking-list"></div>
                </div>
            </div>
        </div>

        <!-- Summary Tab -->
        <div id="summary-tab" class="tab-content">
            <div class="section-header">
                <h2>Dashboard Summary</h2>
                <button class="btn btn-secondary" onclick="refreshSummary()">üîÑ Refresh</button>
            </div>

            <!-- Key Metrics Cards -->
            <div class="summary-metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">üì¶</div>
                    <div class="metric-content">
                        <div class="metric-label">Total Orders</div>
                        <div class="metric-value" id="metric-total-orders">-</div>
                        <div class="metric-change" id="metric-orders-change">-</div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">‚úÖ</div>
                    <div class="metric-content">
                        <div class="metric-label">Completed</div>
                        <div class="metric-value" id="metric-completed">-</div>
                        <div class="metric-change" id="metric-completed-change">-</div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üöö</div>
                    <div class="metric-content">
                        <div class="metric-label">Active Routes</div>
                        <div class="metric-value" id="metric-active-routes">-</div>
                        <div class="metric-change" id="metric-routes-change">-</div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üë•</div>
                    <div class="metric-content">
                        <div class="metric-label">Active Drivers</div>
                        <div class="metric-value" id="metric-active-drivers">-</div>
                        <div class="metric-change" id="metric-drivers-change">-</div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">‚è±Ô∏è</div>
                    <div class="metric-content">
                        <div class="metric-label">Avg Delivery Time</div>
                        <div class="metric-value" id="metric-avg-time">-</div>
                        <div class="metric-change" id="metric-time-change">-</div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üìà</div>
                    <div class="metric-content">
                        <div class="metric-label">Success Rate</div>
                        <div class="metric-value" id="metric-success-rate">-</div>
                        <div class="metric-change" id="metric-success-change">-</div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="summary-charts-grid">
                <div class="chart-card">
                    <h3>Orders by Status</h3>
                    <div id="status-chart" class="chart-container">
                        <canvas id="status-chart-canvas"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Orders by Source</h3>
                    <div id="source-chart" class="chart-container">
                        <canvas id="source-chart-canvas"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Daily Delivery Trend</h3>
                    <div id="trend-chart" class="chart-container">
                        <canvas id="trend-chart-canvas"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Priority Distribution</h3>
                    <div id="priority-chart" class="chart-container">
                        <canvas id="priority-chart-canvas"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="summary-activity">
                <h3>Recent Activity</h3>
                <div id="recent-activity-list" class="activity-list"></div>
            </div>
        </div>

        <!-- Archive Tab -->
        <div id="archive-tab" class="tab-content">
            <div class="section-header">
                <h2>Delivery Archive</h2>
                <div class="actions">
                    <select id="archive-filter-status" onchange="loadArchive()" class="filter-select">
                        <option value="">All Statuses</option>
                        <option value="completed">Completed</option>
                        <option value="failed">Failed</option>
                    </select>
                    <input type="date" id="archive-filter-date" onchange="loadArchive()" class="filter-select">
                    <button class="btn btn-secondary" onclick="loadArchive()">üîÑ Refresh</button>
                </div>
            </div>

            <div class="archive-stats-bar">
                <div class="archive-stat">
                    <span class="archive-stat-label">Total Archived</span>
                    <span class="archive-stat-value" id="archive-total">0</span>
                </div>
                <div class="archive-stat">
                    <span class="archive-stat-label">This Month</span>
                    <span class="archive-stat-value" id="archive-month">0</span>
                </div>
                <div class="archive-stat">
                    <span class="archive-stat-label">This Week</span>
                    <span class="archive-stat-value" id="archive-week">0</span>
                </div>
            </div>

            <div id="archive-list" class="archive-list"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script src="../shared/config.js"></script>
    <script src="../shared/apiClient.js"></script>
    <script src="app.js"></script>
</body>
</html>
